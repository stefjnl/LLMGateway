# US-001: Project Initialization & Repository Setup

---

## User Story

**As a** developer  
**I want to** initialize a .NET Aspire solution with Clean Architecture structure and version control  
**So that** I have a solid foundation to build the LLM Gateway MVP

---

## Acceptance Criteria

### ✅ Criterion 1: .NET Aspire Solution Created
- [ ] Solution contains 5 projects following Clean Architecture layers
- [ ] All projects target .NET 9.0
- [ ] Aspire AppHost project orchestrates service discovery
- [ ] Projects compile without errors
- [ ] Solution opens successfully in VS Code

### ✅ Criterion 2: GitHub Repository Configured
- [ ] Remote repository created: `LLMGateway` (already created: https://github.com/stefjnl/LLMGateway.git )
- [ ] .NET-specific .gitignore applied
- [ ] Initial commit pushed with solution structure
- [ ] Repository includes README with project overview
- [ ] Clean commit history (no bin/obj folders committed)

### ✅ Criterion 3: Development Environment Ready
- [ ] All required NuGet packages restored
- [ ] VS Code C# extension recognizes all projects
- [ ] Can build solution via `dotnet build`
- [ ] Can run Aspire dashboard via `dotnet run --project AppHost`

---

## Prerequisites

**Required Tools:**
- .NET 9 SDK installed
- VS Code with C# Dev Kit extension
- Git installed and configured
- GitHub account with SSH/HTTPS access
- Docker Desktop running (for Aspire dashboard)

**Verify installation:**
```bash
dotnet --version          # Should show 9.0.x
git --version
code --version
docker --version
```

---

## Step-by-Step Implementation

### Step 1: Create Solution Structure (5 minutes)


**1.1 Create solution**
```bash
dotnet new sln -n LLMGateway
```

**1.2 Create project folders**
```bash
mkdir -p src/LLMGateway.Domain
mkdir -p src/LLMGateway.Application
mkdir -p src/LLMGateway.Infrastructure
mkdir -p src/LLMGateway.Api
mkdir -p src/LLMGateway.AppHost
mkdir -p tests/LLMGateway.Domain.Tests
mkdir -p tests/LLMGateway.Application.Tests
mkdir -p tests/LLMGateway.Api.Tests
mkdir -p docs/adr
```

**1.3 Create Domain project (no dependencies)**
```bash
cd src/LLMGateway.Domain
dotnet new classlib -f net9.0
cd ../..
dotnet sln add src/LLMGateway.Domain/LLMGateway.Domain.csproj
```

**1.4 Create Application project**
```bash
cd src/LLMGateway.Application
dotnet new classlib -f net9.0
dotnet add reference ../LLMGateway.Domain/LLMGateway.Domain.csproj
cd ../..
dotnet sln add src/LLMGateway.Application/LLMGateway.Application.csproj
```

**1.5 Create Infrastructure project**
```bash
cd src/LLMGateway.Infrastructure
dotnet new classlib -f net9.0
dotnet add reference ../LLMGateway.Domain/LLMGateway.Domain.csproj
dotnet add reference ../LLMGateway.Application/LLMGateway.Application.csproj
cd ../..
dotnet sln add src/LLMGateway.Infrastructure/LLMGateway.Infrastructure.csproj
```

**1.6 Create API project**
```bash
cd src/LLMGateway.Api
dotnet new webapi -f net9.0 --use-minimal-apis false
dotnet add reference ../LLMGateway.Application/LLMGateway.Application.csproj
dotnet add reference ../LLMGateway.Infrastructure/LLMGateway.Infrastructure.csproj
cd ../..
dotnet sln add src/LLMGateway.Api/LLMGateway.Api.csproj
```

**1.7 Create Aspire AppHost**
```bash
cd src/LLMGateway.AppHost
dotnet new aspire-apphost -f net9.0
dotnet add reference ../LLMGateway.Api/LLMGateway.Api.csproj
cd ../..
dotnet sln add src/LLMGateway.AppHost/LLMGateway.AppHost.csproj
```

**1.8 Create Test projects**
```bash
cd tests/LLMGateway.Domain.Tests
dotnet new xunit -f net9.0
dotnet add reference ../../src/LLMGateway.Domain/LLMGateway.Domain.csproj
cd ../..
dotnet sln add tests/LLMGateway.Domain.Tests/LLMGateway.Domain.Tests.csproj

cd tests/LLMGateway.Application.Tests
dotnet new xunit -f net9.0
dotnet add reference ../../src/LLMGateway.Application/LLMGateway.Application.csproj
cd ../..
dotnet sln add tests/LLMGateway.Application.Tests/LLMGateway.Application.Tests.csproj

cd tests/LLMGateway.Api.Tests
dotnet new xunit -f net9.0
dotnet add reference ../../src/LLMGateway.Api/LLMGateway.Api.csproj
cd ../..
dotnet sln add tests/LLMGateway.Api.Tests/LLMGateway.Api.Tests.csproj
```

---

### Step 2: Add Core NuGet Packages (5 minutes)

**2.1 Infrastructure packages**
```bash
cd src/LLMGateway.Infrastructure
dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL
dotnet add package Microsoft.EntityFrameworkCore.Design
dotnet add package Microsoft.SemanticKernel
dotnet add package Microsoft.Extensions.Http.Polly
dotnet add package Polly
cd ../..
```

**2.2 API packages**
```bash
cd src/LLMGateway.Api
dotnet add package Serilog.AspNetCore
dotnet add package Serilog.Sinks.Console
dotnet add package Serilog.Sinks.File
dotnet add package Swashbuckle.AspNetCore
cd ../..
```

**2.3 Test packages**
```bash
cd tests/LLMGateway.Domain.Tests
dotnet add package FluentAssertions
dotnet add package Moq
cd ../..

cd tests/LLMGateway.Application.Tests
dotnet add package FluentAssertions
dotnet add package Moq
cd ../..

cd tests/LLMGateway.Api.Tests
dotnet add package FluentAssertions
dotnet add package Moq
dotnet add package Microsoft.AspNetCore.Mvc.Testing
cd ../..
```

**2.4 Verify build**
```bash
dotnet build
```
Expected output: `Build succeeded. 0 Warning(s). 0 Error(s).`

---

### Step 3: Configure Git & GitHub (10 minutes)

**3.1 Create .gitignore**
```bash
# From root directory
curl -o .gitignore https://raw.githubusercontent.com/github/gitignore/main/VisualStudio.gitignore
```

**Or create manually:**
```gitignore
## .gitignore for .NET
# User-specific files
*.rsuser
*.suo
*.user
*.userosscache
*.sln.docstates

# Build results
[Dd]ebug/
[Dd]ebugPublic/
[Rr]elease/
[Rr]eleases/
x64/
x86/
[Ww][Ii][Nn]32/
[Aa][Rr][Mm]/
[Aa][Rr][Mm]64/
bld/
[Bb]in/
[Oo]bj/
[Ll]og/
[Ll]ogs/

# Visual Studio cache/options
.vs/
.vscode/
*.suo
*.user
.idea/

# NuGet
*.nupkg
*.snupkg
**/packages/*
!**/packages/build/
*.nuget.props
*.nuget.targets
project.lock.json
project.fragment.lock.json
artifacts/

# .NET Core
project.lock.json
project.fragment.lock.json
artifacts/

# Test results
[Tt]est[Rr]esult*/
[Bb]uild[Ll]og.*
*.trx
*.coverage
*.coveragexml

# Logs
*.log
logs/

# OS files
.DS_Store
Thumbs.db

# Rider
.idea/
*.sln.iml

# User secrets
**/appsettings.Development.json
secrets.json

# Database
*.db
*.db-shm
*.db-wal
```

**3.2 Initialize Git repository**
```bash
git init
git add .
git commit -m "Initial commit: Clean Architecture solution structure"
```

**3.3 Create GitHub repository**


```bash
# Link local to remote
git remote add origin https://github.com/stefjnl/LLMGateway.git
git branch -M main
git push -u origin main
```

---

### Step 4: Create Initial README (5 minutes)

**Create `README.md` in root:**
```markdown
# LLM Gateway

Enterprise LLM Gateway with Semantic Kernel orchestration - demonstrating Clean Architecture in .NET 9.

## Architecture

**Clean Architecture (Onion Pattern)** with Semantic Kernel as orchestration engine.

```
Domain → Application (SK Plugins) → Infrastructure (SK Services) → API
```

## Tech Stack

- **.NET 9** - Latest LTS framework
- **Semantic Kernel** - AI orchestration
- **PostgreSQL** - Request logging & cost tracking
- **EF Core** - ORM with repository pattern
- **Serilog** - Structured logging
- **Polly** - Resilience patterns
- **.NET Aspire** - Orchestration & observability

## Project Structure

```
src/
├── LLMGateway.Domain         # Entities, value objects, interfaces
├── LLMGateway.Application    # SK plugins, orchestration, DTOs
├── LLMGateway.Infrastructure # SK services, EF Core, repositories
├── LLMGateway.Api            # Controllers, middleware
└── LLMGateway.AppHost        # Aspire orchestration

tests/
├── LLMGateway.Domain.Tests
├── LLMGateway.Application.Tests
└── LLMGateway.Api.Tests
```

## Getting Started

### Prerequisites

- .NET 9 SDK
- Docker Desktop (for PostgreSQL)
- OpenRouter API key

### Quick Start

```bash
# Restore packages
dotnet restore

# Run with Aspire
dotnet run --project src/LLMGateway.AppHost

# Access Aspire dashboard
open http://localhost:15500
```

## Roadmap

- [x] US-001: Project initialization
- [ ] US-002: Domain layer implementation
- [ ] US-003: Application layer (SK plugins)
- [ ] US-004: Infrastructure layer (SK services + EF Core)
- [ ] US-005: API layer + endpoints
- [ ] US-006: End-to-end testing

## Architecture Decisions

See [docs/adr](docs/adr/) for detailed architectural decision records.

## License

MIT
```

**Commit README:**
```bash
git add README.md
git commit -m "docs: Add initial README with project overview"
git push
```

---

### Step 5: Create VS Code Workspace (2 minutes)

**Create `.vscode/settings.json`:**
```json
{
  "files.exclude": {
    "**/bin": true,
    "**/obj": true
  },
  "omnisharp.enableRoslynAnalyzers": true,
  "omnisharp.enableEditorConfigSupport": true,
  "dotnet.defaultSolution": "LLMGateway.sln",
  "[csharp]": {
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
      "source.organizeImports": "explicit"
    }
  }
}
```

**Create `.vscode/tasks.json`:**
```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build",
      "command": "dotnet",
      "type": "process",
      "args": [
        "build",
        "${workspaceFolder}/LLMGateway.sln"
      ],
      "problemMatcher": "$msCompile"
    },
    {
      "label": "test",
      "command": "dotnet",
      "type": "process",
      "args": [
        "test",
        "${workspaceFolder}/LLMGateway.sln"
      ],
      "problemMatcher": "$msCompile"
    }
  ]
}
```

**Create `.vscode/launch.json`:**
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Aspire AppHost",
      "type": "coreclr",
      "request": "launch",
      "preLaunchTask": "build",
      "program": "${workspaceFolder}/src/LLMGateway.AppHost/bin/Debug/net9.0/LLMGateway.AppHost.dll",
      "args": [],
      "cwd": "${workspaceFolder}/src/LLMGateway.AppHost",
      "stopAtEntry": false,
      "serverReadyAction": {
        "action": "openExternally",
        "pattern": "\\bNow listening on:\\s+(https?://\\S+)"
      },
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  ]
}
```

**Commit VS Code config:**
```bash
git add .vscode/
git commit -m "chore: Add VS Code workspace configuration"
git push
```

---

## Verification Steps

**Run these commands to verify success:**

```bash
# 1. Solution builds
dotnet build
# Expected: Build succeeded. 0 Warning(s). 0 Error(s).

# 2. Tests run (will pass by default - xUnit generates passing test)
dotnet test
# Expected: Passed! - Failed: 0, Passed: 3, Skipped: 0

# 3. Aspire dashboard launches
dotnet run --project src/LLMGateway.AppHost
# Expected: Dashboard opens at http://localhost:15000

# 4. Git status clean
git status
# Expected: nothing to commit, working tree clean

# 5. Remote synchronized
git remote -v
# Expected: origin pointing to your GitHub repo
```

---

## Definition of Done

- [x] Solution compiles without errors
- [x] All 8 projects exist with correct dependencies
- [x] NuGet packages restored successfully
- [x] .gitignore prevents bin/obj from being committed
- [x] GitHub repository created and initial commit pushed
- [x] README.md provides project overview
- [x] VS Code workspace configured with build/debug tasks
- [x] Aspire dashboard launches successfully
- [x] Tests pass (default xUnit tests)

---

## Troubleshooting


**Issue: Aspire dashboard fails to start**
```bash
# Ensure Docker Desktop is running
docker ps

# Install Aspire workload
dotnet workload install aspire
```

**Issue: VS Code doesn't recognize projects**
```bash
# Install C# Dev Kit extension
code --install-extension ms-dotnettools.csdevkit

# Reload window
# CMD/CTRL + Shift + P → "Developer: Reload Window"
```
